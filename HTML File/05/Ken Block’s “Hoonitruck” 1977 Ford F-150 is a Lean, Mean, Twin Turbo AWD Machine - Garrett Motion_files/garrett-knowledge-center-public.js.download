(function( $ ) {
	'use strict';

	/*$(document).on('click', '.knowledge-center__col__title button', function(){
		$('.knowledge-center-block').addClass('loading');
		if ($(this).hasClass('active')) {
			$.ajax({
                type: 'POST',
                url: ajax_obj.ajax_url,
                data: {
                    action : 'gkc_collapse_column',
                },
                success: function(data){
                	var html = data.html;
                    $('.knowledge-center-block').html(html).removeClass('loading');
                },
                error: function(MLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown);
                }
            });
		} else {
			var cat_id = $(this).data('cat');
			$.ajax({
                type: 'POST',
                url: ajax_obj.ajax_url,
                data: {
                    action : 'gkc_expand_column',
                    cat_id : cat_id,
                },
                success: function(data){
                	var html = data.html;
                    $('.knowledge-center-block').html(html).removeClass('loading');
                },
                error: function(MLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown);
                }
            });
		}
	});*/

	$(document).on('click', '.knowledge-center__toolbar__filter > button', function(e){
	    $('.knowledge-center__toolbar__filter ul').hide();
		$(this).next().slideToggle(300);
		$(this).toggleClass('active');
		e.stopPropagation();
	});

	$(document).on('click', '.knowledge-center__toolbar__filter > ul', function(e){
		e.stopPropagation();
	});

	$(document).on('click', function(e){
		$('.knowledge-center__toolbar__filter > button').removeClass('active');
		$('.knowledge-center__toolbar__filter > ul').slideUp(300);
		$('.knowledge-center__toolbar__search__autocomplete').hide();
	});

	$(document).on('click', '.knowledge-center__toolbar__search', function(e){
		e.stopPropagation();
	});

	$(document).on('keyup', '.knowledge-center__toolbar__search .form-item input[type="text"]', function(){
		var val = $(this).val();
		if (val.length > 2) {
			$('.knowledge-center__toolbar__search').addClass('loading');
			$.ajax({
                type: 'POST',
                url: ajax_obj.ajax_url,
                data: {
                    action : 'gkc_search_autocomplete',
                    s : val,
                },
                success: function(data){
                    $('.knowledge-center__toolbar__search__autocomplete').html(data.html).show();
                    $('.knowledge-center__toolbar__search__results').html(data.results);
                    $('.knowledge-center__toolbar__search').removeClass('loading');
                },
                error: function(MLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown);
                }
            });
		} else {
			$('.knowledge-center__toolbar__search__autocomplete').html('').hide();
			$('.knowledge-center__toolbar__search__results').html('');
		}
	});
    $(document).on('click', '.knowledge-center__badge', function(){
        if($(".knowledge-center__badge").length === 1){
            var base = $('#knowledge-center-toolbar').data()['categoryUrl'];
            window.location = base + "/knowledge-center/" ;
        }else {
            var uncheckCateg = $(this).data()["categ"];
            $('[value="'+uncheckCateg+'"]').click();
            $(this).remove();
        }
    });


    $(document).on('change', '.knowledge-center__toolbar__filter > ul > li input', function(){
        var categs="";
        var taxonomy ="";
        var checkedObjs = $('[name="knowledge-filter"]:checked');
        $.each(checkedObjs, function( index, item ) {
            if(checkedObjs.length === 1){
                taxonomy = item.dataset.category;
                categs = item.value;
            }else{
                if(checkedObjs.length > 1 && index < (checkedObjs.length - 1)){
                    if(index===0){
                        taxonomy = item.dataset.category;
                    }
                    categs += (item.value+"+") ;
                }else {
                    categs += item.value;
                }
            }

        });
        var base = $('#knowledge-center-toolbar').data()['categoryUrl'];
        var url="#";
        if (base) {
            if(taxonomy !== ""){
                url = base + taxonomy + categs  + "/";
            }else{
                url = base + "/knowledge-center/";
            }

        }
        window.location = url ;
    });

    $(document).on('click', 'a[data-dmessage]', function(){
        var message = $(this).data('dmessage');
        if (message) {
            $('body').append('<div class="dmessage-overlay"><div class="dmessage-popup"><div class="text"><span class="gkc-icon-check"></span>' + message + '</div></div></div>');
            $('.dmessage-overlay').fadeIn(300);
            setTimeout(function(){
                $('.dmessage-overlay').fadeOut(300);
            }, 4000);

            setTimeout(function(){
                $('.dmessage-overlay').remove();
            }, 4500);
        }
    });

    $('.gkc-carousel').slick({
        dots: false,
        slidesToShow: 1,
        // centerMode: true,
        arrows: true,
        infinite: false,
        mobileFirst: true,
        prevArrow: '<span class="slick-nav slick-prev"><i class="fa fa-angle-left"></i></span>',
        nextArrow: '<span class="slick-nav slick-next"><i class="fa fa-angle-right"></i></span>',
        responsive: [
            {
                breakpoint: 992,
                settings: 'unslick'
            }
        ]
    });

    $(document).on('click', '#go-back-btn',function (){
        window.location.href = "/knowledge-center"
    })

    var wpPagenavi = $(".wp-pagenavi");
    var wpPagenaviParent = wpPagenavi.parents()[0];
    var isKC = $(".garrett-knowledge-center").length;
    if(window.innerWidth>991 && wpPagenavi.length === 1 && isKC>0){
        var wpPagenaviClone = wpPagenavi.clone();
        wpPagenaviClone.css({bottom:-20});
        wpPagenaviClone.appendTo( wpPagenaviParent);
    }

})( jQuery );
