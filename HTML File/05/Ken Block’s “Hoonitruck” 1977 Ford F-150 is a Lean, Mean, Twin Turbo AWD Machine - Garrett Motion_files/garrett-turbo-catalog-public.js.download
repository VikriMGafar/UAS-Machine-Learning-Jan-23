jQuery(document).ready(function($){
	
	// Single product gallery
	if ($('.catalog-product-thumbs').length) {
			$('.catalog-product-thumbs').slick({
			infinite: false,
			speed: 300,
			slidesToShow: 4,
			slidesToScroll: 1,
			autoplay: false,
			autoplaySpeed: 9000,
			prevArrow: '<div class="slick-nav slick-prev"><i class="fas fa-chevron-up"></i></div>',
			nextArrow: '<div class="slick-nav slick-next"><i class="fas fa-chevron-down"></i></div>',
			dots: false,
			vertical: true,
			verticalSwiping: true,
			customPaging: function(slick, index) {
				return '<span class="dot dot-' + index + '"></span>';
			},
			responsive: [
				{
				  breakpoint: 1360,
				  settings: {
					slidesToShow: 3,
				  }
				},
				{
				  breakpoint: 992,
				  settings: {
					slidesToShow: 4,
				  }
				},
				{
				  breakpoint: 768,
				  settings: {
					slidesToShow: 3,
					  vertical: false,
					  verticalSwiping: false,
					  prevArrow: '<div class="slick-nav slick-prev"><i class="fas fa-chevron-left"></i></div>',
					  nextArrow: '<div class="slick-nav slick-next"><i class="fas fa-chevron-right"></i></div>',
				  }
				}
			]
		});
		
		$(document).on('click', '.turbo-specs-gallery-item-thumb', function(){
			$('.turbo-specs-gallery-item-thumb').removeClass('active');
			$(this).addClass('active');
			var img = $(this).find('img').attr('src');
			$('.turbo-specs-gallery-item-v2 a').attr('href', img);
			$('.turbo-specs-gallery-item-v2 img').attr('src', img);
		});
	}

	$(document).on('click', '.find-tubo-blank-btn', function(){
        $('#findTurboModal').modal('toggle');
    });
    
    $(document).on('click', '.find-turbo-categories ul li', function(){
        $('.find-turbo-categories ul li').removeClass('active');
        $(this).addClass('active');
        
        var type = $(this).data('type');
        $('.find-turbo-form-tab').removeClass('active');
        $('.find-turbo-form-tab[data-type="'+type+'"]').addClass('active');
    });

    // Load search results table
	function turbo_get_results_table(type) {
		var language = $('html').attr('lang');
		
		var manufacturer = $('select[name="turbo_vehicle_manufacturer"]').val();
        var model = $('select[name="turbo_vehicle_model"]').val();
		
		var vehicle = $('select[name="turbo_engine_vehicle"]').val();
        var engine = $('#turbo_find_engine_name').val();
		
		$('.find-turbo-section-wrapper').addClass('loading');
		
		$.ajax({
			type: 'POST',
			url: ajax_obj.ajax_url,
			data: {
				action : 'turbo_get_results_table',
				manufacturer : manufacturer,
				model : model,
				language : language,
				engine : engine,
				vehicle : vehicle,
				gPartNo : $('#gpart_number').val(),
				oePartNo : $('#oe_number').val(),
				refPartNo: $('#rfpart_number').val(),
				type : type
			},
			success: function(data){
				$('#turbo-search-results-block').html(data.html);
				$('#turbo-results-table').DataTable({
					searching: false,
					dom: "<'row'<'col-sm-3'l><'col-sm-3'f><'col-sm-6'p>>" + "<'row'<'col-sm-12'tr>>" + "<'row'<'col-sm-5'i><'col-sm-7'p>>",
					ordering: false
				});
				if ($('.find-turbo-section-results').length) {
					$('body, html').animate({scrollTop : $('.find-turbo-section-results').offset().top - $('.header-wrapper').outerHeight() - 80}, 'slow');
				}
				
				$('.find-turbo-section-wrapper').removeClass('loading');
				
				//var query = JSON.parse(data.params);
				//console.log(data);
				$('#catalog-save-query-form input[name="params"]').val(JSON.stringify(data.params));
			},
			error: function(MLHttpRequest, textStatus, errorThrown){
				console.log(errorThrown);
			}
		});
	}

	// Load Vehicle Models by Manufacturer
    $(document).on('change', 'select[name="turbo_vehicle_manufacturer"]', function(){ // BY VEHICLE
        $('select[name="turbo_vehicle_model"]').val('').prop('disabled', true);
        $('select[name="turbo_vehicle_model"]').parents('.form-item').addClass('ajax-loading-form-item');
        $('.find-turbo-form').addClass('loading');
		
		var language = $('html').attr('lang');
        var manufacturer = $(this).val();
        if (manufacturer !== '') {
            $.ajax({
                type: 'POST',
                url: ajax_obj.ajax_url,
                data: {
                    action : 'get_model_by_manufacturer',
                    manufacturer : manufacturer,
					language : language
                },
                success: function(data){
                    $('select[name="turbo_vehicle_model"]').html(data).prop('disabled', false);
                    $('select[name="turbo_vehicle_model"]').parents('.form-item').removeClass('ajax-loading-form-item');
                    $('.find-turbo-form').removeClass('loading');
                },
                error: function(MLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown);
                }
            });
            
        } else {
            $('select[name="turbo_vehicle_model"]').val('').prop('disabled', true);
            $('select[name="turbo_vehicle_model"]').parents('.form-item').addClass('ajax-loading-form-item');
        }
    });
    
    // Search by vehicle (submit form)
    $(document).on('click', '#by_vehicle', function(){
        var manufacturer = $('select[name="turbo_vehicle_manufacturer"]').val();
        var model = $('select[name="turbo_vehicle_model"]').val();
		var language = $('html').attr('lang');
        if (manufacturer !== '' && model !== '') {
			turbo_get_results_table('vehicle');
			var newUrl = document.location.protocol +"//"+ document.location.hostname + document.location.pathname + '?search=findbyVehicle&vMfg=' + manufacturer + '&vModel=' + model;
			history.pushState({}, null, newUrl);
        } else {
            return false;
        }
    });
	
	// Search by engine predictions
	$('#turbo_find_engine_name').on('keyup', function(){
        $('#form-item-find-engine-autocomplete .fpt-part-number-item ul').remove();
        $('#form-item-find-engine-autocomplete .fpt-part-number-item .error').remove();
		
		var language = $('html').attr('lang');
        
        var currentValue = $(this).val();
        if (currentValue.length >= 3) {
            
            $.ajax({
                type: 'POST',
                url: ajax_obj.ajax_url,
                data: {
                    action : 'get_search_predictions_engine',
                    engine_name : currentValue,
					language : language
                },
                success: function(data){
                    var obj = jQuery.parseJSON(data);
                    if (obj.predictions) {
                        $('#form-item-find-engine-autocomplete .fpt-part-number-item ul').remove();
                        $('#form-item-find-engine-autocomplete .fpt-part-number-item .error').remove();
                        $('#form-item-find-engine-autocomplete .fpt-part-number-item').append(obj.predictions);
                    }
                    if (obj.message) {
                        $('#form-item-find-engine-autocomplete .fpt-part-number-item .error').remove();
                        $('#form-item-find-engine-autocomplete .fpt-part-number-item ul').remove();
                        $('#form-item-find-engine-autocomplete .fpt-part-number-item').append('<div class="error">'+obj.message+'</div>');
                    }
                },
                error: function(MLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown);
                }
            });
            
        }
	});
	
	// Load vehicles manufacturers by engine code
	$(document).on('click', '#form-item-find-engine-autocomplete .button', function(){
		$('select[name="turbo_engine_vehicle"]').val('').prop('disabled', true);
        $('select[name="turbo_engine_vehicle"]').parents('.form-item').addClass('ajax-loading-form-item');
        $('.find-turbo-form').addClass('loading');
		
		var language = $('html').attr('lang');
        var engine = $('#turbo_find_engine_name').val();
        if (engine !== '') {
            
            $.ajax({
                type: 'POST',
                url: ajax_obj.ajax_url,
                data: {
                    action : 'get_vehicles_by_engine',
                    engine : engine,
					language : language
                },
                success: function(data){
                    $('select[name="turbo_engine_vehicle"]').html(data).prop('disabled', false);
                    $('select[name="turbo_engine_vehicle"]').parents('.form-item').removeClass('ajax-loading-form-item');
                    $('.find-turbo-form').removeClass('loading');
                },
                error: function(MLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown);
                }
            });
            
        } else {
            $('select[name="turbo_engine_vehicle"]').val('').prop('disabled', true);
            $('select[name="turbo_engine_vehicle"]').parents('.form-item').addClass('ajax-loading-form-item');
        }
	});
    
    // Search by engine (submit form)
    $(document).on('click', '#by_engine', function(){
        var engine = $('#turbo_find_engine_name').val();
        var vehicle = $('select[name="turbo_engine_vehicle"]').val();
        var language = $('html').attr('lang');
        if (engine !== '' && vehicle !== '') {
			turbo_get_results_table('engine');
			var newUrl = document.location.protocol +"//"+ document.location.hostname + document.location.pathname + '?search=findbyEngine&VehManufacturer=' + vehicle + '&EngineCode=' + engine;
			history.pushState({}, null, newUrl);
        } else {
            return false;
        }
    });
    
    // Search by Part Number (submit form)
    $(document).on('click', '#search_garrett', function(){
		var language = $('html').attr('lang');
		
		turbo_get_results_table('garrett');
		//parent.location.hash = "hello";
		var newUrl = document.location.protocol +"//"+ document.location.hostname + document.location.pathname + '?search=findbyPartno&gPartNo=' + $('#gpart_number').val();
		history.pushState({}, null, newUrl);
    });
    
    // Search by part number (predictions)
    $('#gpart_number').on('keyup', function(){
        $('#form-item-search_garrett .fpt-part-number-item ul').remove();
        $('#form-item-search_garrett .fpt-part-number-item .error').remove();
        
        if ($(this).val().length >= 12) {
            $('#search_garrett').prop('disabled', false);
        } else {
            $('#search_garrett').prop('disabled', true);
        }
		
		var language = $('html').attr('lang');
        
        var currentValue = $(this).val();
        if (currentValue.length >= 3) {
            
            $.ajax({
                type: 'POST',
                url: ajax_obj.ajax_url,
                data: {
                    action : 'get_search_predictions_garrett',
                    part_number : currentValue,
					language : language
                },
                success: function(data){
                    var obj = jQuery.parseJSON(data);
                    if (obj.predictions) {
                        $('#form-item-search_garrett .fpt-part-number-item ul').remove();
                        $('#form-item-search_garrett .fpt-part-number-item .error').remove();
                        $('#form-item-search_garrett .fpt-part-number-item').append(obj.predictions);
                    }
                    if (obj.message) {
                        $('#form-item-search_garrett .fpt-part-number-item .error').remove();
                        $('#form-item-search_garrett .fpt-part-number-item ul').remove();
                        $('#form-item-search_garrett .fpt-part-number-item').append('<div class="error">'+obj.message+'</div>');
                    }
                },
                error: function(MLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown);
                }
            });
            
        }
	});
    
    $(document).on('click', '.fpt-part-number-item ul li', function(){
        $(this).parents('.fpt-part-number-item').find('input').val($(this).text());
        $(this).parent().hide();
        $(this).parents('.fpt-part-number-item').find('.error').remove();
        $(this).parents('.fpt-part-number-item').find('.button').prop('disabled', false);
    });
    
    // Search by OE Part number (submit form)
    $(document).on('click', '#search_oe', function(){
		var language = $('html').attr('lang');
		
		turbo_get_results_table('oe');
		var newUrl = document.location.protocol +"//"+ document.location.hostname + document.location.pathname + '?search=findbyOEno&oePartNo=' + $('#oe_number').val();
		history.pushState({}, null, newUrl);
    });
    
    // Search by OE part number (predictions)
    $('#oe_number').on('keyup', function(){
        $('#form-item-search_oe .fpt-part-number-item ul').remove();
        $('#form-item-search_oe .fpt-part-number-item .error').remove();
        
        if ($(this).val().length >= 3) {
            $('#search_oe').prop('disabled', false);
        } else {
            $('#search_oe').prop('disabled', true);
        }
		
		var language = $('html').attr('lang');
        
        var currentValue = $(this).val();
        if (currentValue.length >= 3) {
            
            $.ajax({
                type: 'POST',
                url: ajax_obj.ajax_url,
                data: {
                    action : 'get_search_predictions_oe',
                    part_number : currentValue,
					language : language
                },
                success: function(data){
                    var obj = jQuery.parseJSON(data);
                    if (obj.predictions) {
                        $('#form-item-search_oe .fpt-part-number-item ul').remove();
                        $('#form-item-search_oe .fpt-part-number-item .error').remove();
                        $('#form-item-search_oe .fpt-part-number-item').append(obj.predictions);
                    }
                    if (obj.message) {
                        $('#form-item-search_oe .fpt-part-number-item .error').remove();
                        $('#form-item-search_oe .fpt-part-number-item ul').remove();
                        $('#form-item-search_oe .fpt-part-number-item').append('<div class="error">'+obj.message+'</div>');
                    }
                },
                error: function(MLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown);
                }
            });
            
        }
	});
    
    // Search by Reference Part number (submit form)
    $(document).on('click', '#search_reference', function(){
		var language = $('html').attr('lang');
		
		turbo_get_results_table('reference');
		var newUrl = document.location.protocol +"//"+ document.location.hostname + document.location.pathname + '?search=findbyReferenceno&refPartNo=' + $('#rfpart_number').val();
		history.pushState({}, null, newUrl);
    });
    
    // Search by Reference Part number (predictions)
    $('#rfpart_number').on('keyup', function(){
        $('#form-item-search_reference .fpt-part-number-item ul').remove();
        $('#form-item-search_reference .fpt-part-number-item .error').remove();
        
        if ($(this).val().length >= 3) {
            $('#search_reference').prop('disabled', false);
        } else {
            $('#search_reference').prop('disabled', true);
        }
		
		var language = $('html').attr('lang');
        
        var currentValue = $(this).val();
        if (currentValue.length >= 3) {
            
            $.ajax({
                type: 'POST',
                url: ajax_obj.ajax_url,
                data: {
                    action : 'get_search_predictions_reference',
                    part_number : currentValue,
					language : language
                },
                success: function(data){
                    var obj = jQuery.parseJSON(data);
                    if (obj.predictions) {
                        $('#form-item-search_reference .fpt-part-number-item ul').remove();
                        $('#form-item-search_reference .fpt-part-number-item .error').remove();
                        $('#form-item-search_reference .fpt-part-number-item').append(obj.predictions);
                    }
                    if (obj.message) {
                        $('#form-item-search_reference .fpt-part-number-item .error').remove();
                        $('#form-item-search_reference .fpt-part-number-item ul').remove();
                        $('#form-item-search_reference .fpt-part-number-item').append('<div class="error">'+obj.message+'</div>');
                    }
                },
                error: function(MLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown);
                }
            });
            
        }
	});
	
	$(document).on('click', '.cn-products-list .detail-icon', function(){
		$(this).find('i').toggleClass('glyphicon-plus').toggleClass('glyphicon-minus');
		$(this).parents('tr').next('.detail-view').toggle();
	});
    
    $(document).on('click', '.search-part-number-top-tabs ul li', function(){
        $('.search-part-number-top-tabs ul li').removeClass('active');
        $(this).addClass('active');
        
        var target = $(this).data('tab');
        $('.find-turbo-form-tab[data-type="turbo"] .form-item').removeClass('active');
        $('#' + target).addClass('active');
    });
});