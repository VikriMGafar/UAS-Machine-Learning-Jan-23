jQuery(document).ready(function($){
	$(document).on('submit', '.turbo-specs-actions form', function(){
		$('.wishlist-success-message').remove();
		
		if ($('body').hasClass('logged-in')) {
		
			var form_data = new FormData();
			$('.turbo-specs-actions form select, .turbo-specs-actions input').each(function() {
				form_data.append(this.name, $(this).val());
			});

			$.ajax({
				type: 'POST',
				url: ajax_obj.ajax_url,
				data: form_data,
				contentType: false,
				processData: false,
				success: function(data, textStatus, XMLHttpRequest){
					var obj = jQuery.parseJSON(data);
					if (obj.message) {
						//$('.turbo-specs-actions').before('<div class="wishlist-success-message alert alert-success"><p>'+obj.message+'</p></div>');
						$('.floating-menu-wishlist .user-menu-counter').remove();
						$('.floating-menu-wishlist').append('<span class="user-menu-counter">'+obj.count+'</span>');
						window.location.href = obj.redirect;
					}
				},
				error: function(MLHttpRequest, textStatus, errorThrown){
					console.log(errorThrown);
				}
			});
			
		} else {
			$('#loginModal').modal('show');
		}
		
		return false;
    });
	    
    $(document).on('change', 'select[name="wishlist-continent"]', function(){
        var continent = $(this).val();
        if (continent != '') {
            $.ajax({
                type: 'POST',
                url: ajax_obj.ajax_url,
                data: {
                    action : 'update_distributor_continent',
                    continent : continent
                },
                success: function(data){
                    $('select[name="wishlist-country"]').html(data).prop('disabled', false);
                },
                error: function(MLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown);
                }
            });
        } else {
            $('select[name="wishlist-country"]').html('').prop('disabled', true);
        }
    });
	
	$(document).on('change', 'select[name="wishlist-country"]', function(){
        var country = $(this).val();
        if (country != '') {
            $.ajax({
                type: 'POST',
                url: ajax_obj.ajax_url,
                data: {
                    action : 'update_distributor_country',
                    country : country
                },
                success: function(data){
                    $('select[name="wishlist-region"]').html(data).prop('disabled', false);
                },
                error: function(MLHttpRequest, textStatus, errorThrown){
                    console.log(errorThrown);
                }
            });
        } else {
            $('select[name="wishlist-region"]').html('').prop('disabled', true);
        }
    });
	
	$(document).on('click', '.qty-up', function(){
        var val = parseInt($(this).parent().find('input.qty').val(), 10) + 1;
        $(this).parent().find('input.qty').val(val).trigger('change');
        $(this).parent().find('.qty-value').text(val);
    });
    
    $(document).on('click', '.qty-down', function(){
        var val = parseInt($(this).parent().find('input.qty').val(), 10) - 1;
        if (val < 1) {
            val = 1;
        }
        $(this).parent().find('input.qty').val(val).trigger('change');
        $(this).parent().find('.qty-value').text(val);
    });
	
	$('.wishlist-table td .qty-selector input').on('change', function() {
		
		var post_id = $(this).data("product");
        var parent = $(this).parents('tr');
        var qty = $(this).val();
        parent.addClass('loading');
		$.ajax({
			type: 'POST',
			url: ajax_obj.ajax_url,
			data: {
				action: 'update_product_in_wishlist',
				post_id: post_id,
                qty: qty
			},
			success: function(data, textStatus, XMLHttpRequest){
	    		parent.removeClass('loading');
                var obj = JSON.parse(data);
				$('.floating-menu-wishlist .user-menu-counter').remove();
				$('.floating-menu-wishlist').append('<span class="user-menu-counter">'+obj.count+'</span>');
			},
			error: function(MLHttpRequest, textStatus, errorThrown){
				console.log(errorThrown);
			}
		});
		
		return false;
	});
    
    $(document).on('click', '.remove-product-wishlist', function() {
		
		var post_id = $(this).data("product");
        var parent = $(this).parents('tr');
        parent.addClass('loading');
		$.ajax({
			type: 'POST',
			url: ajax_obj.ajax_url,
			data: {
				action: 'remove_product_from_wishlist',
				post_id: post_id
			},
			success: function(data, textStatus, XMLHttpRequest){
	    		parent.remove();
                var obj = JSON.parse(data);
				$('.floating-menu-wishlist .user-menu-counter').remove();
				$('.floating-menu-wishlist').append('<span class="user-menu-counter">'+obj.count+'</span>');
			},
			error: function(MLHttpRequest, textStatus, errorThrown){
				console.log(errorThrown);
			}
		});
		
		return false;
	});
	
	$(document).on('click', '.activate-ebadge-btn', function(){
		var level_id = $(this).data('level');
		$('.myaccount-ebadge-form-wrapper').html('<p>Loading...</p>');
		$.ajax({
			type: 'POST',
			url: ajax_obj.ajax_url,
			data: {
				action: 'training_activate_ebadge_form',
				level_id: level_id
			},
			success: function(data, textStatus, XMLHttpRequest){
				$('.myaccount-ebadge-form-wrapper').html(data);
                if ($('.myaccount-ebadge-form-wrapper').length) {
                    $('body, html').animate({scrollTop : $('.myaccount-ebadge-form-wrapper').offset().top - $('.header-wrapper').outerHeight()});
                }
			},
			error: function(MLHttpRequest, textStatus, errorThrown){
				console.log(errorThrown);
			}
		});
	});
	
	$(document).on('click', '.view-ebadge-btn', function(){
		var level_id = $(this).data('level');
		$('.myaccount-ebadge-form-wrapper').html('<p>Loading...</p>');
		$.ajax({
			type: 'POST',
			url: ajax_obj.ajax_url,
			data: {
				action: 'training_activate_ebadge_form',
				level_id: level_id
			},
			success: function(data, textStatus, XMLHttpRequest){
				$('.myaccount-ebadge-form-wrapper').html(data);
			},
			error: function(MLHttpRequest, textStatus, errorThrown){
				console.log(errorThrown);
			}
		});
	});
	
	$(document).on('change', '.activate-badge-form input[name="fname"]', function(){
		if ($(this).val()) {
			$('.eBadgeNamePreview .fname').text($(this).val());
		} else {
			$('.eBadgeNamePreview .fname').text($('.eBadgeNamePreview .fname').data('init'));
		}
	});
	
	$(document).on('change', '.activate-badge-form input[name="lname"]', function(){
		if ($(this).val()) {
			$('.eBadgeNamePreview .lname').text($(this).val());
		} else {
			$('.eBadgeNamePreview .lname').text($('.eBadgeNamePreview .lname').data('init'));
		}
	});
	
	$(document).on('change', '.activate-badge-form input[name="garage"]', function(){
		if ($(this).val()) {
			$('.eBadgeGaragePreview span').text($(this).val());
		} else {
			$('.eBadgeGaragePreview span').text($('.eBadgeGaragePreview span').data('init'));
		}
	});
	
	$(document).on('submit', '.activate-badge-form form', function(){
		var form = $(this);
		var form_data = new FormData();
        $(this).find('input').each(function() {
            form_data.append(this.name, $(this).val());
        });
		$(this).find('select').each(function() {
            form_data.append(this.name, $(this).val());
        });
		form.addClass('loading');
        
		$.ajax({
			type: 'POST',
			url: ajax_obj.ajax_url,
			data: form_data,
            contentType: false,
            processData: false,
			success: function(data, textStatus, XMLHttpRequest){
                //var obj = jQuery.parseJSON(data);
				form.removeClass('loading');
				location.reload();
			},
			error: function(MLHttpRequest, textStatus, errorThrown){
				console.log(errorThrown);
			}
		});
		
		return false;
	});
});